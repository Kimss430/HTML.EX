<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/admin-style.css">
</head>

<body>
    <div id="user-management" class="section" v-if="currentSection === 'user-management'">
        <h2>회원 관리</h2>
        <button @click="loadUsers">회원 목록 불러오기</button>
        <table v-if="users.length">
            <thead>
                <tr>
                    <th>아이디</th>
                    <th>이름</th>
                    <th>이메일</th>
                    <th>전화번호</th>
                    <th>주소</th>
                    <th>상태</th>
                    <th>작업</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="user in users" :key="user.id">
                    <td>{{ user.id }}</td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone }}</td>
                    <td>{{ user.address }}</td>
                    <td>{{ user.status }}</td>
                    <td>
                        <button @click="editUser(user.id)">수정</button>
                        <button @click="deleteUser(user.id)">삭제</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <div v-if="editUserId">
            <h3>회원 수정</h3>
            <input v-model="currentUser.id" placeholder="아이디" readonly>
            <input v-model="currentUser.name" placeholder="이름">
            <input v-model="currentUser.email" placeholder="이메일">
            <input v-model="currentUser.phone" placeholder="전화번호">
            <input v-model="currentUser.address" placeholder="주소">
            <button @click="updateUser">저장</button>
        </div>
    </div>
</body>
<script>
    data() {
        return {
            currentSection: 'user-management',
            users: [],
            editUserId: null,
            currentUser: {
                id: "",
                name: "",
                email: "",
                phone: "",
                address: ""
            }
        };
    };
    methods: {
    async loadUsers() {
            try {
                const response = await fetch('http://localhost:3000/users');
                const data = await response.json();
                this.users = data;
            } catch (error) {
                console.error("Error loading users:", error);
            }
        },
    async editUser(id) {
            this.editUserId = id;
            const user = this.users.find(user => user.id === id);
            this.currentUser = { ...user };
        },
    async updateUser() {
            try {
                await fetch(`http://localhost:3000/users/${this.currentUser.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(this.currentUser)
                });
                alert("회원 정보가 업데이트되었습니다.");
                this.loadUsers();  // Refresh user list
                this.editUserId = null;
            } catch (error) {
                console.error("Error updating user:", error);
            }
        },
    async deleteUser(id) {
            try {
                await fetch(`http://localhost:3000/users/${id}`, {
                    method: 'DELETE'
                });
                alert("회원이 삭제되었습니다.");
                this.loadUsers();  // Refresh user list
            } catch (error) {
                console.error("Error deleting user:", error);
            }
        }
    }

</script>

</html>